<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Curso M√∫sica F√°cil</title>

<style>

/* ============================= */
/* ===== CONFIGURA√á√ÉO GERAL ==== */
/* ============================= */

body{
    margin:0;
    font-family: Arial, sans-serif;
    text-align:center;
    color:white;
}

header{
    background:#111;
    color:white;
    padding:15px;
    position:fixed;
    top:0;
    width:100%;
    z-index:1000;
}

nav button{
    margin:5px;
    padding:8px 15px;
    border:none;
    border-radius:20px;
    cursor:pointer;
    font-weight:bold;
}

.tela{
    display:none;
    padding-top:130px;
    min-height:100vh;
}

/* ============================= */
/* ===== TELA 1 - RITMO ======= */
/* ============================= */

#tela1{
    background: linear-gradient(135deg,#ff8c00,#ff3c00);
}

.pontuacao{
    font-size:18px;
    margin-top:10px;
}

.pergunta{
    font-size:22px;
    margin:15px;
}

.pauta{
    margin:20px auto;
    width:350px;
}

.notas-container{
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:20px;
    margin-top:20px;
}

.nota{
    background:white;
    border-radius:15px;
    padding:15px;
    cursor:pointer;
    transition:0.3s;
    color:black;
    width:120px;
}

.nota:hover{
    transform:scale(1.1);
    background:#ffe066;
}

.correto{
    font-size:30px;
    font-weight:bold;
    color:#00ff66;
}

.errado{
    font-size:26px;
    color:#ffffff;
}

#proximo{
    margin-top:20px;
    padding:10px 20px;
    font-size:18px;
    border:none;
    border-radius:10px;
    background:#222;
    color:white;
    cursor:pointer;
    display:none;
}

/* ============================= */
/* ===== TELA 2 - NOTAS ======= */
/* ============================= */

#tela2{
    background: linear-gradient(135deg,#2196f3,#0d47a1);
}

.staff{
    margin:30px auto;
    width:350px;
    height:160px;
    position:relative;
}

.staff-line{
    position:absolute;
    width:100%;
    height:2px;
    background:white;
}

.note-dot{
    position:absolute;
    width:18px;
    height:18px;
    background:yellow;
    border-radius:50%;
}

.note-name{
    position:absolute;
    font-size:14px;
    font-weight:bold;
}

.notas-botoes{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:15px;
    margin-top:20px;
}

.botao-nota{
    padding:10px 15px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
}

.botao-nota:hover{
    transform:scale(1.1);
}


/* =========================
   TELA 3 - CONTADOR DE TEMPO
========================= */
/* ============================= */
/* ===== TELA 3 - AJUSTADA ==== */
/* ============================= */

#tela3{
    background: linear-gradient(135deg,#2e7d32,#1b5e20);
    color:white;
    padding:120px 15px 40px 15px; /* espa√ßo para header fixo */
    box-sizing:border-box;
}

/* √Årea da pauta */
.pauta3{
    margin:30px auto;
    width:100%;
    max-width:1000px;
    height:220px;
    position:relative;
    overflow-x:auto; /* permite rolagem no celular */
}

/* Linhas */
.linha3{
    position:absolute;
    width:100%;
    height:2px;
    background:white;
}

/* Clave */
.clave3{
    position:absolute;
    left:10px;
    top:55px;
    font-size:70px;
}

/* Container das notas */
.compassos3{
    position:absolute;
    left:100px;
    top:0;
    height:100%;
    display:flex;
    align-items:flex-end;
    min-width:800px; /* mant√©m propor√ß√£o */
}

/* Wrapper nota + contagem */
.notaWrapper3{
    display:flex;
    flex-direction:column;
    align-items:center;
}

/* Nota */
.nota3{
    font-size:42px;
    transition:0.1s;
}

.nota3.ativa{
    transform:scale(1.3);
    color:yellow;
}

/* N√∫mero embaixo */
.contagem3{
    font-size:16px;
    margin-top:5px;
    color:#ffd54f;
}

/* Cursor */
.cursor3{
    position:absolute;
    top:45px;
    width:3px;
    height:110px;
    background:red;
    left:100px;
}

/* Controles */
.controles3{
    text-align:center;
}

.controles3 button{
    margin:8px;
    padding:10px 18px;
    border:none;
    border-radius:15px;
    cursor:pointer;
    font-weight:bold;
}

/* üì± Ajuste celular */
@media (max-width:768px){

    .pauta3{
        height:180px;
    }

    .clave3{
        font-size:50px;
        top:65px;
    }

    .nota3{
        font-size:30px;
    }

    .contagem3{
        font-size:13px;
    }

    .cursor3{
        height:90px;
    }

}


</style>
</head>

<body>

<header>
    <h2>üéº Curso M√∫sica F√°cil</h2>
    <nav>
        <button style="background:#ff9800;color:white;" 
                onclick="mostrarTela('tela1')">
            üü† Figuras de Som
        </button>

        <button style="background:#2196f3;color:white;" 
                onclick="mostrarTela('tela2')">
            üîµ Notas na Pauta
        </button>

        <button style="background:#2e7d32;color:white;" 
                onclick="mostrarTela('tela3')">
            üü¢ Contador de Tempo
        </button>
    </nav>
    
</header>


<!-- ================= TELA 1 ================= -->

<section id="tela1" class="tela">

<h1>üéµ N√≠vel 1 - Figuras de Som</h1>

<div class="pontuacao">
‚≠ê Pontos: <span id="pontos">0</span> |
‚ùå Erros: <span id="erros">0</span>
</div>

<div class="pergunta" id="pergunta"></div>

<svg class="pauta" height="130">
  <line x1="60" y1="30" x2="340" y2="30" stroke="white" stroke-width="2"/>
  <line x1="60" y1="50" x2="340" y2="50" stroke="white" stroke-width="2"/>
  <line x1="60" y1="70" x2="340" y2="70" stroke="white" stroke-width="2"/>
  <line x1="60" y1="90" x2="340" y2="90" stroke="white" stroke-width="2"/>
  <line x1="60" y1="110" x2="340" y2="110" stroke="white" stroke-width="2"/>
  <circle id="notaCerta" cx="200" cy="70" r="8" fill="yellow" style="display:none;"/>
</svg>

<div class="notas-container">

<div class="nota" onclick="verificar(4)">
    <svg width="40" height="40">
        <ellipse cx="20" cy="20" rx="12" ry="8"
                 fill="white" stroke="black" stroke-width="2"/>
    </svg>
    <div>4 tempos</div>
</div>

<div class="nota" onclick="verificar(2)">
    <svg width="40" height="50">
        <ellipse cx="20" cy="30" rx="10" ry="7"
                 fill="white" stroke="black" stroke-width="2"/>
        <line x1="30" y1="30" x2="30" y2="5"
              stroke="black" stroke-width="2"/>
    </svg>
    <div>2 tempos</div>
</div>

<div class="nota" onclick="verificar(1)">
    <svg width="40" height="50">
        <ellipse cx="20" cy="30" rx="10" ry="7"
                 fill="black"/>
        <line x1="30" y1="30" x2="30" y2="5"
              stroke="black" stroke-width="2"/>
    </svg>
    <div>1 tempo</div>
</div>

<div class="nota" onclick="verificar(0.5)">
    <svg width="50" height="60">
        <ellipse cx="20" cy="35" rx="10" ry="7"
                 fill="black"/>
        <line x1="30" y1="35" x2="30" y2="10"
              stroke="black" stroke-width="2"/>
        <path d="M30 10 Q45 20 30 25"
              stroke="black" stroke-width="2" fill="none"/>
    </svg>
    <div>1/2 tempo</div>
</div>

</div>

<div id="resposta"></div>
<button id="proximo" onclick="novaPergunta()">Pr√≥ximo ‚ñ∂</button>

</section>

<!-- ================= TELA 2 ================= -->

<section id="tela2" class="tela">

<h1>üéº N√≠vel 2 - Notas na Pauta</h1>

<div class="staff" id="staff">
<div class="staff-line" style="top:30px;"></div>
<div class="staff-line" style="top:50px;"></div>
<div class="staff-line" style="top:70px;"></div>
<div class="staff-line" style="top:90px;"></div>
<div class="staff-line" style="top:110px;"></div>
</div>

<div class="notas-botoes">
<button class="botao-nota" onclick="mostrarNota('Mi')">Mi</button>
<button class="botao-nota" onclick="mostrarNota('F√°')">F√°</button>
<button class="botao-nota" onclick="mostrarNota('Sol')">Sol</button>
<button class="botao-nota" onclick="mostrarNota('L√°')">L√°</button>
<button class="botao-nota" onclick="mostrarNota('Si')">Si</button>
<button class="botao-nota" onclick="mostrarNota('D√≥')">D√≥</button>
<button class="botao-nota" onclick="mostrarNota('R√©')">R√©</button>
</div>

</section>

<!-- ============================= -->
<!-- TELA 3 -->
<!-- ============================= -->

<!-- ================= TELA 3 ================= -->

<section id="tela3" class="tela">

<h1>‚è± N√≠vel 3 - Leitura de Compassos</h1>

<div class="controles3">
<button onclick="gerarTela3()">Gerar</button>
<button onclick="tocarTela3()">Play</button>
<button onclick="pausarTela3()">Pausar</button>
</div>

<div class="pauta3">

<div class="linha3" style="top:50px;"></div>
<div class="linha3" style="top:70px;"></div>
<div class="linha3" style="top:90px;"></div>
<div class="linha3" style="top:110px;"></div>
<div class="linha3" style="top:130px;"></div>

<div class="clave3">ùÑû</div>

<div id="cursor3" class="cursor3"></div>

<div id="compassos3" class="compassos3"></div>

</div>

</section>




<script>

/* ===== CONTROLE DE TELAS ===== */

function mostrarTela(id){
    document.querySelectorAll(".tela").forEach(t=>t.style.display="none");
    document.getElementById(id).style.display="block";
}

mostrarTela("tela1");

/* ===== TELA 1 ===== */

let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let bpm = 60;
let tempo = 60 / bpm;

let valores = [4,2,1,0.5];
let respostaCorreta;
let pontos = 0;
let erros = 0;

function tocarSom(duracao){
    let agora = audioCtx.currentTime;
    let osc = audioCtx.createOscillator();
    let gain = audioCtx.createGain();

    osc.type = "sine";
    osc.frequency.value = 440;
    gain.gain.value = 0.3;

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(agora);
    osc.stop(agora + (duracao * tempo));
}

function novaPergunta(){
    respostaCorreta = valores[Math.floor(Math.random()*valores.length)];
    document.getElementById("pergunta").innerHTML =
        "Qual figura vale <strong>" + respostaCorreta + " tempo(s)</strong>?";
    document.getElementById("resposta").innerHTML = "";
    document.getElementById("notaCerta").style.display = "none";
    document.getElementById("proximo").style.display = "none";
}

function verificar(valor){
    tocarSom(valor);
    if(valor === respostaCorreta){
        pontos++;
        document.getElementById("pontos").innerText = pontos;
        document.getElementById("resposta").innerHTML = "<div class='correto'>‚úî CORRETO!</div>";
        document.getElementById("notaCerta").style.display = "block";
    }else{
        erros++;
        document.getElementById("erros").innerText = erros;
        document.getElementById("resposta").innerHTML = "<div class='errado'>‚úò Tente novamente!</div>";
    }
    document.getElementById("proximo").style.display = "inline-block";
}

novaPergunta();

/* ===== TELA 2 ===== */

const posicoes = {
  "Mi":110,
  "F√°":100,
  "Sol":90,
  "L√°":80,
  "Si":70,
  "D√≥":60,
  "R√©":50
};

const frequencias = {
  "Mi":329.63,
  "F√°":349.23,
  "Sol":392.00,
  "L√°":440.00,
  "Si":493.88,
  "D√≥":523.25,
  "R√©":587.33
};

function mostrarNota(nota){

    const staff = document.getElementById("staff");
    staff.querySelectorAll(".note-dot,.note-name").forEach(e=>e.remove());

    const bolinha = document.createElement("div");
    bolinha.className="note-dot";
    bolinha.style.top = posicoes[nota]+"px";
    bolinha.style.left = "160px";

    const nome = document.createElement("div");
    nome.className="note-name";
    nome.innerText = nota;
    nome.style.top = (posicoes[nota]-20)+"px";
    nome.style.left = "160px";

    staff.appendChild(bolinha);
    staff.appendChild(nome);

    tocarNota(frequencias[nota]);
}

function tocarNota(freq){
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type="triangle";
    osc.frequency.value=freq;

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    gain.gain.setValueAtTime(0,audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0.6,audioCtx.currentTime+0.02);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+1);

    osc.start();
    osc.stop(audioCtx.currentTime+1);
}


/* ============================= */
/* TELA 3 - SCRIPT */
/* ===== TELA 3 COMPLETA CORRIGIDA ===== */

let notas3=[];
let intervalo3=null;
let indice3=0;
let tocando3=false;

let bpm3 = 80;

const figuras3=[
  {simbolo:"‚ô™", valor:0.5},
  {simbolo:"‚ô©", valor:1},
  {simbolo:"ùÖû", valor:2},
  {simbolo:"ùÖù", valor:4}
];

function gerarTela3(){

    const container=document.getElementById("compassos3");
    container.innerHTML="";
    notas3=[];
    indice3=0;

    const totalCompassos = 3;
    const temposPorCompasso = 4;

    for(let c=0;c<totalCompassos;c++){

        let soma=0;

        let tempoAtual = 1;
        let metadeTempo = false;

        while(soma<temposPorCompasso){

            let figura=figuras3[Math.floor(Math.random()*figuras3.length)];

            if(soma+figura.valor<=temposPorCompasso){

                let wrapper=document.createElement("div");
                wrapper.className="notaWrapper3";

                let nota=document.createElement("div");
                nota.className="nota3";
                nota.innerText=figura.simbolo;

                let largura = figura.valor*60;
                wrapper.style.width=largura+"px";

                let contagem=document.createElement("div");
                contagem.className="contagem3";

                let textoContagem="";

                // =============================
                // CONTAGEM MUSICAL CORRETA
                // =============================

                if(figura.valor===4){
                    textoContagem="1 2 3 4";
                    tempoAtual=1;
                    metadeTempo=false;
                }

                else if(figura.valor===2){
                    textoContagem=tempoAtual+" "+(tempoAtual+1);
                    tempoAtual+=2;
                    metadeTempo=false;
                }

                else if(figura.valor===1){
                    textoContagem=tempoAtual;
                    tempoAtual+=1;
                    metadeTempo=false;
                }

                else if(figura.valor===0.5){

                    if(!metadeTempo){
                        textoContagem=tempoAtual;
                        metadeTempo=true;
                    }else{
                        textoContagem="e";
                        metadeTempo=false;
                        tempoAtual+=1;
                    }
                }

                contagem.innerText=textoContagem;

                wrapper.appendChild(nota);
                wrapper.appendChild(contagem);

                container.appendChild(wrapper);

                notas3.push({
                    elemento:nota,
                    valor:figura.valor
                });

                soma+=figura.valor;
            }
        }

        // barra de compasso
        let barra=document.createElement("div");
        barra.style.width="4px";
        barra.style.height="100px";
        barra.style.background="white";
        barra.style.margin="0 15px";
        container.appendChild(barra);
    }
}

function tocarTela3(){

    if(notas3.length===0) return;
    if(tocando3) return;

    tocando3=true;

    const cursor=document.getElementById("cursor3");

    tocarProxima();

    function tocarProxima(){

        if(!tocando3) return;

        if(indice3>=notas3.length){
            indice3=0;
        }

        let atual=notas3[indice3];

        notas3.forEach(n=>n.elemento.classList.remove("ativa"));
        atual.elemento.classList.add("ativa");

        cursor.style.left=(100+atual.elemento.parentElement.offsetLeft)+"px";

        tocarSomTela3(atual.valor, indice3===0);

        let duracao = (60000 / bpm3) * atual.valor;

        indice3++;

        intervalo3=setTimeout(tocarProxima,duracao);
    }
}

function tocarSomTela3(valor, forte){

    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type="triangle";
    osc.frequency.value=forte?523:440;

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    let duracao = (60000 / bpm3) * valor / 1000;

    gain.gain.setValueAtTime(0,audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(forte?0.6:0.3,audioCtx.currentTime+0.02);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duracao);

    osc.start();
    osc.stop(audioCtx.currentTime+duracao);
}

function pausarTela3(){
    clearTimeout(intervalo3);
    tocando3=false;
}


</script>

</body>
</html>
